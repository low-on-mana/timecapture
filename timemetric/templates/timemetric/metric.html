{% extends "timemetric/admin/base.html" %}
{% load staticfiles %}
{% load i18n %}
{% block extrastyle %}
{% include 'timecapture/basic_css.html' %}
<link rel="stylesheet" href="{% static 'admin/css/forms.css' %}">
<link rel="stylesheet" href="{% static 'bootstrap-daterangepicker-master/daterangepicker.css' %}">
<style>
    #header {
        box-sizing: content-box;
    }
    #site-name {
        line-height : inherit;   /* fuckin bootstrap wasted hours here */
    }
    .sel-all, .rem-all {
        cursor: pointer;
    }
</style>
{% endblock %}



{% block title %}{{ title }} | {{ site_title|default:_('Django site admin') }}{% endblock %}


{% block branding %}
<h1 id="site-name"><a href="{% url 'admin:index' %}">{{ site_header|default:_('Django administration') }}</a></h1>
{% endblock %}


{% block content %}

<!-- Errors -->
{% if form.errors and not form.non_field_errors %}
<p class="errornote">
{% if form.errors.items|length == 1 %}{% trans "Please correct the error below." %}{% else %}{% trans "Please correct the errors below." %}{% endif %}
</p>
{% endif %}

{% if form.non_field_errors %}
{% for error in form.non_field_errors %}
<p class="errornote">
    {{ error }}
</p>
{% endfor %}
{% endif %}
<!-- Errors end -->

{{ form.startdate.errors }}
{{ form.enddate.errors }}

<form id="theonlyform" enctype="multipart/form-data">
{{form.startdate}}
{{form.enddate}}
<fieldset class="module aligned">
<div class="form-row">
    <label for="{{form.daterange.id_for_label}}">{{form.daterange.label}}</label>
    {{form.daterange.errors}}{{form.daterange}}
    <p class="help">{{form.daterange.help_text}}</p>
</div>
<div class="form-row" >
    <label for="{{form.client.id_for_label}}">{{form.client.label}}</label>
    {{form.client.errors}}{{form.client}}
    <p class="help">{{form.client.help_text}}</p>
</div>
<div class="form-row" >
    <label for="{{form.jobtype.id_for_label}}">{{form.jobtype.label}}</label>
    {{form.jobtype.errors}}{{form.jobtype}}
    <a class="sel-all">Select All</a>&nbsp;&nbsp;
    <a  class="rem-all">Remove All</a>
    <p class="help">{{form.jobtype.help_text}}</p>
</div>
<div class="form-row" >
    <label for="{{form.employee.id_for_label}}">{{form.employee.label}}</label>
    {{form.employee.errors}}{{form.employee}}
    <a  class="sel-all">Select All</a>&nbsp;&nbsp;
    <a  class="rem-all">Remove All</a>
    <p class="help">{{form.employee.help_text}}</p>
</div>
<div class="form-row" >
</div>
<div class="submit-row">
    <input id="submitbutton" type="submit" value="submit" class="default" name="_save"/>
</div>
</fieldset>
</form>
<p id='ignorePDF'></p>
{% if query_bool %}
{% include 'timemetric/analytics_snippet.html' %}
{% endif %}
{% endblock %}

{% block footer %}
{% include 'timecapture/basic_js.html' %}
<script src="{% static 'bootstrap-daterangepicker-master/moment.min.js' %}"></script>
<script src="{% static 'bootstrap-daterangepicker-master/daterangepicker.js' %}"></script>
<script src="{% static 'jspdf.min.js' %}"></script>
<script type="text/javascript">
$(document).ready(function() {

    $('.sel-all').click(function(){
         $('option', $(this).parent()).prop('selected',true);
    });

    $('.rem-all').click(function(){
         $('option', $(this).parent()).prop('selected',false);
    });
    function cb(start, end) {
        $('#{{ form.daterange.id_for_label }}').val(start.format('YYYY-MM-DD') + ' - ' + end.format('YYYY-MM-DD'));
        console.log(start.format('YYYY-MM-DD') + ' - ' + end.format('YYYY-MM-DD'));
        $('#{{ form.startdate.id_for_label }}').val(start.format('YYYY-MM-DD'));
        $('#{{ form.enddate.id_for_label }}').val(end.format('YYYY-MM-DD'));
    }

    $('#{{ form.daterange.id_for_label }}').daterangepicker({
        ranges: {
           'Today': [moment(), moment()],
           'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
           'Last 7 Days': [moment().subtract(6, 'days'), moment()],
           'Last 30 Days': [moment().subtract(29, 'days'), moment()],
           'This Month': [moment().startOf('month'), moment().endOf('month')],
           'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
        }
    }, cb);
    cb(moment().subtract(29, 'days'), moment());
    $('div.ranges>ul>li').css('list-style-type','none');
    {% if query_bool %}
    $('#myModal').modal('show');
    $('#getPDF').click(function(){
        var specialElementHandlers = {
            '#ignorePDF':function(element,renderer){
                return true;
            }
        };
        var doc = new jsPDF('p','pt','a4');
        doc.setFontSize(15);
        doc.fromHTML($('#render-to-pdf').html(),15,15, {
            'width': 170,
            'elementHandlers': specialElementHandlers
        });
        doc.save('sample.pdf');
    });
    {% endif %}

});
</script>
{% endblock %}
